<h1>git rebaseçš„ç”¨æ³•</h1><div class="toc-article"><strong class="toc-title">Contents</strong><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#å¿«è¿›åˆå¹¶"><span class="toc-number">1.</span> <span class="toc-text">å¿«è¿›åˆå¹¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åŸºæœ¬çš„åˆå¹¶æ“ä½œ"><span class="toc-number">2.</span> <span class="toc-text">åŸºæœ¬çš„åˆå¹¶æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å­˜åœ¨çš„é—®é¢˜"><span class="toc-number">3.</span> <span class="toc-text">å­˜åœ¨çš„é—®é¢˜</span></a></li></ol></div><p>git ä½œä¸ºä»£ç ç®¡ç†å·¥å…·ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ merge(æ™®é€šåˆå¹¶)å’Œ rebase(è¡åˆæˆ–å˜åŸº)æ¥åˆå¹¶ä»£ç ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨å“ªå‘¢ï¼Ÿ</p>
<h3 id="å¿«è¿›åˆå¹¶">å¿«è¿›åˆå¹¶</h3>
<p>ä»€ä¹ˆæ˜¯å¿«è¿›åˆå¹¶ï¼Ÿå¦‚ä¸‹ï¼Œåˆå¹¶ dev åˆ†æ”¯åˆ° master åˆ†æ”¯æ—¶ï¼Œmaster åˆ†æ”¯åœ¨ dev åˆ†æ”¯çš„èµ·ç‚¹ B åå¹¶æ²¡æœ‰åšä»»ä½•æ›´æ”¹ï¼Œdev åˆ†æ”¯åŒ…å«æ‰€æœ‰ master åˆ†æ”¯ä¸Šçš„å†å²ï¼Œå› æ­¤åªè¦æŠŠ master åˆ†æ”¯çš„ä½ç½®ç§»åŠ¨åˆ° dev çš„æœ€æ–°æäº¤ä¸Šï¼Œåˆ†æ”¯å°±åˆå¹¶äº†ï¼Œè¿™å«åšå¿«è¿›(fast-forward)åˆå¹¶ã€‚</p>
<pre><code class="language-code">                 dev
                  |
      C1â”â”â”&gt;D1â”â”â”&gt;E1
      /
Aâ”â”â”&gt;B
     |
   master

//å¿«è¿›åˆå¹¶
                     dev
                      |
 Aâ”â”â”&gt;Bâ”â”â”C1â”â”â”&gt;D1â”â”â”&gt;E1
                      |
                    master</code></pre>
<h3 id="åŸºæœ¬çš„åˆå¹¶æ“ä½œ">åŸºæœ¬çš„åˆå¹¶æ“ä½œ</h3>
<p>å¦‚ä¸‹ï¼Œåœ¨ commit ä¸º B æ—¶å¼€å‡ºä¸€ä¸ªåˆ†æ”¯ devï¼Œå¹¶å¼€å‘åˆ° E1ï¼Œmaster åˆ†æ”¯ä¹Ÿåˆ°äº† D2ã€‚</p>
<pre><code class="language-code">                 dev
                  |
      C1â”â”â”&gt;D1â”â”â”&gt;E1
      /
Aâ”â”â”&gt;Bâ”â”â”&gt;C2â”â”â”&gt;D2
                |
              master</code></pre>
<p>å°†åˆ†æ”¯ dev <strong>merge</strong> åˆ° master:</p>
<pre><code class="language-code">//åœ¨masteråˆ†æ”¯ä¸Š
$ git merge dev</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œmerge ä¼šäº§ç”Ÿä¸€ä¸ªå¤šä½™çš„æäº¤å†å² F:</p>
<pre><code class="language-code">                  dev
                  |
      C1â”â”â”&gt;D1â”â”â”&gt;E1
      /            \
Aâ”â”â”&gt;Bâ”â”â”&gt;C2â”â”â”&gt;D2â”â”F
                    |
                  master</code></pre>
<p>é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨å¼€å‘åˆ†æ”¯ï¼Œæƒ³è¦ä¸ master çš„æ›´æ–°ä¿æŒä¸€è‡´ï¼Œå°±å¯ä»¥åœ¨å¼€å‘åˆ†æ”¯ rebase masterã€‚</p>
<pre><code class="language-code">//åœ¨devåˆ†æ”¯ä¸Š
$ git rebase master</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œdev åˆ†æ”¯ä¸ŠåŸæœ‰çš„ C1ã€D1ã€E1 è¢«åˆ é™¤åé‡æ–°æäº¤ä¸º C1&#39;ã€D1&#39;ã€E1&#39;äº†ï¼Œå®ƒçš„åŸç†æ˜¯æ‰¾åˆ°ä¸¤ä¸ªåˆ†æ”¯æœ€è¿‘çš„ç¥–å…ˆæäº¤ï¼Œç„¶åæ ¹æ®å½“å‰åˆ†æ”¯(devï¼Œè¦è¡åˆçš„åˆ†æ”¯)åç»­çš„æäº¤ç”Ÿæˆä¸€äº›åˆ—è¡¥ä¸æ–‡ä»¶ï¼Œç„¶åä»¥åŸºåº•åˆ†æ”¯(master åˆ†æ”¯)æœ€åä¸€ä¸ªæäº¤ä¸ºåŸºå‡†ç‚¹ï¼Œé€ä¸ªåº”ç”¨è¿™äº›è¡¥ä¸æ–‡ä»¶ï¼Œç”Ÿæˆæ–°çš„æäº¤ï¼Œä»è€Œæ”¹å˜äº†æäº¤å†å²ï¼Œä½¿å…¶æˆä¸º master åˆ†æ”¯çš„ç›´æ¥ä¸‹æ¸¸ã€‚</p>
<pre><code class="language-code">                              dev
                               |
      C2â”â”â”&gt;D2â”â”â”C1&#39;â”â”â”&gt;D1&#39;â”â”â”&gt;E1&#39;
      /
Aâ”â”â”&gt;Bâ”â”â”&gt;C2â”â”â”&gt;D2
                |
              master</code></pre>
<p>ç°åœ¨å°±å¯ä»¥å›åˆ° master åˆ†æ”¯è¿›è¡Œå¿«è¿›åˆå¹¶äº†ï¼Œæœ€ç»ˆçš„æäº¤å†å²å¦‚ä¸‹æ‰€ç¤ºï¼Œæ¯”è¾ƒå¹²å‡€æ•´æ´ã€‚</p>
<pre><code class="language-code">                                dev
                                 |
Aâ”â”â”Bâ”â”â”C2â”â”â”&gt;D2â”â”â”C1&#39;â”â”â”&gt;D1&#39;â”â”â”&gt;E1&#39;
                                 |
                               master</code></pre>
<h3 id="å­˜åœ¨çš„é—®é¢˜">å­˜åœ¨çš„é—®é¢˜</h3>
<p>è€ƒè™‘å¦‚ä¸‹çš„æƒ…æ™¯ï¼Œæˆ‘çš„é¡¹ç›®é‡Œæœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªä¸»åˆ†æ”¯ masterï¼Œä¸€ä¸ªå¼€å‘åˆ†æ”¯ devã€‚</p>
<pre><code class="language-code">   dev
    |
Aâ”â”â”B
    |
  master</code></pre>
<p>ç°åœ¨å°æ˜åœ¨ dev åˆ†æ”¯ä¸Šå¼€å‘ï¼Œå¹¶æŠŠæ–°çš„æäº¤ C1ã€C2 æ¨é€åˆ°äº†è¿œç¨‹æœåŠ¡å™¨ã€‚</p>
<pre><code class="language-code">            dev
             |
       C1â”â”â”&gt;C2
      /
Aâ”â”â”B
    |
  master</code></pre>
<p>å°çº¢åœ¨ dev åˆ†æ”¯å°æ˜çš„æäº¤åŸºç¡€ä¸Šé«˜é«˜å…´å…´åœ°å¼€å‘ï¼Œå¹¶æ–°æäº¤äº† C3ã€C4ã€‚</p>
<pre><code class="language-code">                        dev
                         |
       C1â”â”â”&gt;C2â”â”â”&gt;C3â”â”â”&gt;C4
      /
Aâ”â”â”B
    |
  master</code></pre>
<p>ç°åœ¨å°æ˜æƒ³åŒæ­¥ master ä¸Šçš„æœ€æ–°å†…å®¹(å°ä¸œæäº¤åˆ° master ä¸Šçš„ C)ï¼Œåœ¨ dev ä¸Šè¿›è¡Œäº† rebaseï¼Œä¹‹å‰çš„æäº¤ C1ã€C2 è¢«åˆ é™¤æ‰å˜æˆäº† C1&#39;å’Œ C2&#39;äº†ï¼Œå°æ˜ç»§ç»­å¼€å‘åˆ°äº† D1ã€‚</p>
<pre><code class="language-code">                       dev
                        |
          C1â€™â”â”â”&gt;C2â€˜â”â”â”&gt;D1
         /
Aâ”â”â”Bâ”â”â”C
        |
      master</code></pre>
<p>å°æ˜æ¥ç€æŠŠå½“å‰çš„ä¿®æ”¹æ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç»“æœæŠ¥é”™ï¼š</p>
<pre><code class="language-code"> ! [rejected]        dev -&gt; dev (non-fast-forward)
hint: Updates were rejected because the tip of your current branch is behind
hint: its remote counterpart. Integrate the remote changes (e.g.
hint: &#39;git pull ...&#39;) before pushing again.</code></pre>
<p>è¡¨ç¤ºä¸èƒ½è¿›è¡Œå¿«è¿›åˆå¹¶ï¼Œå°æ˜æ¨é€å‰æœåŠ¡å™¨ç«¯çš„ dev åˆ†æ”¯å¦‚ä¸‹ï¼š</p>
<pre><code class="language-code">               dev
                |
Aâ”â”â”&gt;Bâ”â”â”&gt;C1â”â”â”&gt;C2</code></pre>
<p>æ˜¾ç„¶å°æ˜æœ¬åœ°çš„åˆ†æ”¯å› ä¸º rebaseï¼ŒåŸæœ‰çš„æäº¤ C1ã€C2 æ²¡æœ‰äº†ï¼Œä¹Ÿå°±è¯´å°æ˜æœ¬åœ°çš„ dev åˆ†æ”¯å¹¶æ²¡æœ‰åŒ…å«æœåŠ¡å™¨ç«¯ dev åˆ†æ”¯çš„å…¨éƒ¨æäº¤å†å²ï¼Œä¹Ÿå°±ä¸èƒ½è¿›è¡Œæäº¤ã€‚åªèƒ½å…ˆ pull æœåŠ¡å™¨ç«¯çš„ä»£ç å¹¶è§£å†²çªã€‚</p>
<pre><code class="language-code">          remotes/origin/dev
                  |
      C1â”â”â”â”â”â”â”â”â”&gt;C2
     /              \
Aâ”â”â”B    ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£   \
     \                \
      Câ”&gt;C1â€™â”&gt;C2â€˜â”&gt;D1â”&gt;F
                       |
                      dev</code></pre>
<p>æäº¤çº¿å›¾å°±å˜æˆäº†ä¸‹é¢è¿™æ ·ï¼š</p>
 <center><img src="http://blog-bed.oss-cn-beijing.aliyuncs.com/36.rebase%E7%9A%84%E7%94%A8%E6%B3%95/git%20rebase%E6%8F%90%E4%BA%A4%E7%BA%BF%E5%9B%BE.png" /></center>
å¯ä»¥çœ‹åˆ°å°æ˜æœ¬åœ°å®é™…ä¸Šå·²ç»æäº¤è¿‡C1ã€C2äº†ï¼Œå› ä¸ºrebaseçš„å…³ç³»å˜æˆäº†C1'ã€C2'ï¼Œä¸æœåŠ¡å™¨ä¸­çš„C1ã€C2 SHA-1ä¸ä¸€æ ·äº†ï¼Œä»è€Œå½“æ–°çš„æäº¤å¤„ç†ã€‚äºæ˜¯æˆ‘ä»¬å°±èƒ½çœ‹åˆ°æäº¤ä¿¡æ¯ã€å†…å®¹ä¸€æ ·çš„æäº¤ï¼Œæäº¤çº¿å°±ä¼šå˜å¾—æ··ä¹±ï¼Œè®©äººæ„Ÿåˆ°å›°æƒ‘ã€‚
å½“å°çº¢æ‹‰å–å°æ˜çš„ä»£ç åï¼Œå› ä¸ºåœ¨å°çº¢çš„æœ¬åœ°å­˜åœ¨å·²ç»è¢«æ’¤é”€çš„C1ã€C2ï¼Œå¥¹ä¸å¾—ä¸å†æ¬¡åˆå¹¶æœ‰ç€åŒæ ·å†…å®¹çš„C1'ã€C2'çš„æäº¤ï¼Œäº‹æƒ…å˜å¾—æ›´åŠ ç³Ÿç³•ã€‚è¿™é‡Œï¼Œé—®é¢˜å°±å‡ºåœ¨å°æ˜èº«ä¸Šï¼Œä»–å‘å¸ƒäº†C1ã€C2ï¼Œåˆé€šè¿‡rebaseé‡æ–°å‘å¸ƒäº†C1â€™ã€C2â€˜ã€‚

<p>å…³äº rebaseï¼Œæœ‰ä¸€æ¡é‡‘ç§‘ç‰å¾‹ï¼Œå°±æ˜¯<strong>ä¸è¦åœ¨å…¬å…±åˆ†æ”¯è¿›è¡Œ rebase</strong>ã€‚ å¦‚æœåœ¨å·²ç»è¢«æ¨é€åˆ°å…¬å…±ä»“åº“çš„æäº¤ä¸Šæ‰§è¡Œå˜åŸºå‘½ä»¤ï¼Œå¹¶å› æ­¤ä¸¢å¼ƒäº†ä¸€äº›åˆ«äººçš„å¼€å‘æ‰€åŸºäºçš„æäº¤ï¼Œé‚£ä½ å°±æœ‰éº»çƒ¦äº†ï¼Œé¢å¯¹åŒäº‹çš„ç–¯ç‹‚åæ§½å§ï¼ï¼ï¼</p>
