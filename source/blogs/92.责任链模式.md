# 责任链模式

在讨论责任链模式之前，先来看前端经常需要实现表单验证功能：
假如注册新用户要验证用户名，密码，手机号:

- 请假 1-2 天

  如果员工使用年假，则由主管审批，否则由行政部审批。

- 请假 3-5 天

  如果员工使用年假，则由部门经理审批，否则由行政部审批。

- 请假 6-9 天

  如果员工使用年假，则由总监审批，否则由行政部审批。

```ts
const vacate = (dayCount: number, isAnnualVacation: boolean) => {
  if (dayCount <= 2) {
    if (isAnnualVacation) {
      console.log("由主管审批");
    } else {
      console.log("由行政部审批");
    }
  } else if (dayCount <= 5) {
    if (isAnnualVacation) {
      console.log("由部门经理审批");
    } else {
      console.log("由行政部审批");
    }
  } else if (dayCount <= 9) {
    if (isAnnualVacation) {
      console.log("由总监审批");
    } else {
      console.log("由行政部审批");
    }
  }
};
```

显然，这个代码并不那么友好，当要修改审批规则时，不得不深入代码修改，不符合开闭原则。我们将代码进行优化：

```ts
const vacate6To9Days = (dayCount: number, isAnnualVacation: boolean) => {
  if (isAnnualVacation) {
    console.log("由总监审批");
  } else {
    console.log("由行政部审批");
  }
};

const vacate3To5Days = (dayCount: number, isAnnualVacation: boolean) => {
  if (dayCount <= 5 && isAnnualVacation) {
    console.log("由部门经理审批");
  } else {
    vacate6To9Days(dayCount, isAnnualVacation);
  }
};

const vacate1To2Days = (dayCount: number, isAnnualVacation: boolean) => {
  if (dayCount <= 2 && isAnnualVacation) {
    console.log("由主管审批");
  } else {
    vacate3To5Days(dayCount, isAnnualVacation);
  }
};

//业务代码

vacate1To2Days(1, true); //"由主管审批"
vacate1To2Days(3, true); //"由部门经理审批"
vacate1To2Days(3, false); //"由行政部审批"
vacate1To2Days(7, true); //"由总监审批"
vacate1To2Days(7, false); //"由行政部审批"
```

可以看到代码得到了优化，之前大的 if-else 被拆分成了几个小的函数，结构更加清晰，但函数里的依赖链条比较死板，如果中间增加处理人员，就不得不打碎这个链条，深入代码进行修改。

### 责任链

责任链模式的定义就是当请求到来时，让中间所有对象都能够有机会处理请求，从而避免了请求的发送者与后续的一些列接收者之间的耦合关系。

责任链模式是使多个对象都有机会处理请求，从而避免请求的发送者和接受者之间的耦合关系。在职责链模式里，很多对象由每一个对象对其下家的引用而连接起来形成一条链。请求在这个链上传递，直到链上的某一个对象决定处理此请求

节点传递方式也就是，责任链中当前节点处理完成之后，自己传递给下一个处理节点继续处理。

```ts
abstract class Handler {
  private next: Handler;

  public getNext(): Handler {
    return this.next;
  }

  public setNext(next: Handler) {
    this.next = next;
  }
  public abstract handle(request: object): void;
}

class ConcreteHandler1 extends Handler {
  public handle(request: object) {
    console.log(`concrete handler1 excute request`);
    const next = this.getNext();
    if (next) {
      next.handle(request);
    }
  }
}

class ConcreteHandler2 extends Handler {
  public handle(request: object) {
    console.log(`concrete handler2 excute request`);
    const next = this.getNext();
    if (next) {
      next.handle(request);
    }
  }
}

class ConcreteHandler3 extends Handler {
  public handle(request: object) {
    console.log(`concrete handler3 excute request`);
    const next = this.getNext();
    if (next) {
      next.handle(request);
    }
  }
}

const main = () => {
  const handler1 = new ConcreteHandler1();
  const handler2 = new ConcreteHandler2();
  const handler3 = new ConcreteHandler3();

  handler1.setNext(handler2);
  handler2.setNext(handler3);

  handler1.handle({ message: "test" });
};

main();
```
