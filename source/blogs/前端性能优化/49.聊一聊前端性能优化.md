---
layout: post
title: å‰ç«¯æ€§èƒ½ä¼˜åŒ– 24 æ¡å»ºè®®ï¼ˆ2020ï¼‰
category: js
tagline: "Supporting tagline"
tags: [Other]
description:
date: 2019-9-25 18:10:20
---

# [èŠä¸€èŠå‰ç«¯æ€§èƒ½ä¼˜åŒ–](https://juejin.cn/post/6911472693405548557)

## å‰è¨€

æ€§èƒ½ä¼˜åŒ– ï¼Œæ¯ä¸ªå·¥ç¨‹å¸ˆè·‘ä¸æ‰çš„ä¸€ä¸ªè¯é¢˜ã€‚è¿™é‡Œæ˜¯æœ¬äººç»“åˆ Mr.Max çš„ä¸€é—¨è¯¾ï¼Œæ€»ç»“çš„ä¸€äº›ä¼˜åŒ–æ‰‹æ³•ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œåç»­ä¹Ÿä¼šç»§ç»­æ›´æ–°ï¼Œæƒ³è¦çœ‹è§†é¢‘çš„å¯ä»¥ç›´æ¥å»æŸè¯¾ç½‘æœã€‚ æ¼”ç¤ºæºç å’Œ PPT æœ‰æ¡ä»¶åˆ†äº«ï¼ˆä¸€ä¸ªèµ ğŸ‘ï¼‰ï¼Œæ„Ÿè°¢å„ä½å¤§å“¥ ğŸ˜

### æ¼”ç¤º demo

[fe-optimize æºç ](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Falexwjj%2Ffe-optimize)

### æ¼”ç¤º PPT (ä¸€å®šè¦çœ‹ï¼Œè¶…å¸…)

[åœ¨çº¿é¢„è§ˆ](https://link.juejin.cn/?target=https%3A%2F%2Falexwjj.github.io%2Ffe-optimize-ppt%2F)

[fe-ppt ä½¿ç”¨ HTML åšçš„ PPT æºç ](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Falexwjj%2Ffe-ppt)

## å‰ç«¯æ€§èƒ½çš„å½±å“ï¼ˆé•¿ç¯‡å¤§è®ºè­¦å‘Š â—ï¸â—ï¸â—ï¸ï¼‰

å‰ç«¯æ€§èƒ½çš„ä¸€ä¸ªé‡è¦æŒ‡æ ‡æ˜¯é¡µé¢åŠ è½½æ—¶é—´ï¼Œä¸ä»…äº‹å…³ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿæ˜¯æœç´¢å¼•æ“æ’åè€ƒè™‘çš„ä¸€ä¸ªå› ç´ ã€‚

- æ¥è‡ª Google çš„æ•°æ®è¡¨æ˜ï¼Œä¸€ä¸ªæœ‰ 10 æ¡æ•°æ® 0.4 ç§’èƒ½åŠ è½½å®Œçš„é¡µé¢ï¼Œå˜æˆ 30 æ¡æ•°æ® 0.9 ç§’åŠ è½½å®Œä¹‹åï¼Œæµé‡å’Œå¹¿å‘Šæ”¶å…¥ä¸‹é™ 90%ã€‚
- Google Map é¦–é¡µæ–‡ä»¶å¤§å°ä» 100KB å‡å°åˆ° 70-80KB åï¼Œæµé‡åœ¨ç¬¬ä¸€å‘¨æ¶¨äº† 10%ï¼Œæ¥ä¸‹æ¥çš„ä¸‰å‘¨æ¶¨äº† 25%ã€‚
- äºšé©¬é€Šçš„æ•°æ®è¡¨æ˜ï¼šåŠ è½½æ—¶é—´å¢åŠ  100 æ¯«ç§’ï¼Œé”€é‡å°±ä¸‹é™ 1%ã€‚

æ‰€ä»¥ï¼šé‡é“¸æ€§èƒ½ä¹‹å…‰ï¼Œæˆ‘è¾ˆä¹‰ä¸å®¹è¾ ğŸ˜

### ä¸€ã€è°ƒè¯•å·¥å…·

ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ï¼Œè¯»å®Œå¤§å­¦å†æ‰“å·¥ï¼

#### 1ã€Network

![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p1-network.png)

è¿™é‡Œå¯ä»¥çœ‹åˆ°èµ„æºåŠ è½½è¯¦æƒ…ï¼Œåˆæ­¥è¯„ä¼°å½±å“é¡µé¢æ€§èƒ½çš„å› ç´ ã€‚é¼ æ ‡å³é”®å¯ä»¥è‡ªå®šä¹‰é€‰é¡¹å¡ï¼Œé¡µé¢åº•éƒ¨æ˜¯å½“å‰åŠ è½½èµ„æºçš„ä¸€ä¸ªæ¦‚è§ˆã€‚DOMContentLoaded DOM æ¸²æŸ“å®Œæˆçš„æ—¶é—´ï¼ŒLoadï¼šå½“å‰é¡µé¢æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆçš„æ—¶é—´

**æ€è€ƒï¼šå¦‚ä½•åˆ¤æ–­å“ªäº›èµ„æºå¯¹å½“å‰é¡µé¢åŠ è½½æ— ç”¨ï¼Œåšå¯¹åº”ä¼˜åŒ–ï¼Ÿ**
**shift + cmd + P è°ƒå‡ºæ§åˆ¶å°çš„æ‰©å±•å·¥å…·ï¼Œæ·»åŠ è§„åˆ™**
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p2-network-block.png)

**æ‰©å±•å·¥å…· æ›´å¤šä½¿ç”¨å§¿åŠ¿**
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p3-network-control.png)

ç€‘å¸ƒæµ waterfall

- Queueing æµè§ˆå™¨å°†èµ„æºæ”¾å…¥é˜Ÿåˆ—æ—¶é—´
- Stalled å› æ”¾å…¥é˜Ÿåˆ—æ—¶é—´è€Œå‘ç”Ÿçš„åœæ»æ—¶é—´
- DNS Lookup DNS è§£ææ—¶é—´
- Initial connection å»ºç«‹ HTTP è¿æ¥çš„æ—¶é—´
- SSL æµè§ˆå™¨ä¸æœåŠ¡å™¨å»ºç«‹å®‰å…¨æ€§è¿æ¥çš„æ—¶é—´
- TTFB ç­‰å¾…æœåŠ¡ç«¯è¿”å›æ•°æ®çš„æ—¶é—´
- Content Download æµè§ˆå™¨ä¸‹è½½èµ„æºçš„æ—¶é—´

#### 2ã€Lighthouse

![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p5-lighthouse.png)

- First Contentful Paint é¦–å±æ¸²æŸ“æ—¶é—´ï¼Œ1s ä»¥å†…ç»¿è‰²
- Speed Index é€Ÿåº¦æŒ‡æ•°ï¼Œ4s ä»¥å†…ç»¿è‰²
- Time to Interactive åˆ°é¡µé¢å¯äº¤æ¢çš„æ—¶é—´

æ ¹æ® chrome çš„ä¸€äº›ç­–ç•¥è‡ªåŠ¨å¯¹ç½‘ç«™åšä¸€ä¸ªè´¨é‡è¯„ä¼°ï¼Œå¹¶ä¸”ä¼šç»™å‡ºä¸€äº›ä¼˜åŒ–çš„å»ºè®®ã€‚

#### 3ã€Peformance

![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p6-performance.png)
å¯¹ç½‘ç«™æœ€ä¸“ä¸šçš„åˆ†æ~åé¢ä¼šå¤šæ¬¡è®²åˆ°

#### 4ã€webPageTest

å¯ä»¥æ¨¡æ‹Ÿä¸åŒåœºæ™¯ä¸‹è®¿é—®çš„æƒ…å†µï¼Œæ¯”å¦‚æ¨¡æ‹Ÿä¸åŒæµè§ˆå™¨ã€ä¸åŒå›½å®¶ç­‰ç­‰ï¼Œåœ¨çº¿æµ‹è¯•åœ°å€ï¼š[webPageTest](https://link.juejin.cn/?target=https%3A%2F%2Fwww.webpagetest.org%2F)
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p7-webpagetest.png)
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p7-webpagetest2.png)

#### 5ã€èµ„æºæ‰“åŒ…åˆ†æ

**webpack-bundle-analyzer**
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p9-webpack-bundle-analyzer.png)

```
npm install --save-dev webpack-bundle-analyzer
// webpack.config.js æ–‡ä»¶
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin
module.exports={
  plugins: [
    new BundleAnalyzerPlugin({
    analyzerMode: 'server',
    analyzerHost: '127.0.0.1',
    analyzerPort: 8889,
    reportFilename: 'report.html',
    defaultSizes: 'parsed',
    openAnalyzer: true,
    generateStatsFile: false,
    statsFilename: 'stats.json',
    statsOptions: null,
    logLevel: 'info'
  }),
]
}

// package.json
"analyz": "NODE_ENV=production npm_config_report=true npm run build"
```

**å¼€å¯ source-map**
`webpack.config.js`

```js
module.exports = {
  mode: "production",
  devtool: "hidden-source-map",
};
```

`package.json`

```
"analyze": "source-map-explorer 'build/\*.js'",
```

`npm run analyze`
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p10-analyze.png)

### äºŒã€WEB API

å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚æµè§ˆå™¨æä¾›çš„ä¸€äº›åˆ†æ API è‡³å…³é‡è¦

#### 1ã€ç›‘å¬è§†çª—æ¿€æ´»çŠ¶æ€

å¤§å­¦éƒ½åˆ·è¿‡æ…•è¯¾å§ï¼Ÿåªè¦ç¦»å¼€çª—å£è§†é¢‘å°±ä¼šæš‚åœ~

æˆ–è€…ä¸€äº›è€ƒè¯•ç½‘ç«™ï¼Œæé†’ä½ ä¸èƒ½ç¦»å¼€å½“å‰çª—å£

å†æˆ–è€…ï¼Œè¿™ç§æ•ˆæœ~
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p11-document.gif)

```js
// çª—å£æ¿€æ´»çŠ¶æ€ç›‘å¬
let vEvent = "visibilitychange";
if (document.webkitHidden != undefined) {
  vEvent = "webkitvisibilitychange";
}

function visibilityChanged() {
  if (document.hidden || document.webkitHidden) {
    document.title = "å®¢å®˜ï¼Œåˆ«èµ°å•Š~";
    console.log("Web page is hidden.");
  } else {
    document.title = "å®¢å®˜ï¼Œä½ åˆå›æ¥äº†å‘¢~";
    console.log("Web page is visible.");
  }
}

document.addEventListener(vEvent, visibilityChanged, false);
```

å…¶å®æœ‰å¾ˆå¤šéšè—çš„ apiï¼Œè¿™é‡Œå¤§å®¶æœ‰å…´è¶£çš„å¯ä»¥å»è¯•è¯•çœ‹ï¼š

#### 2ã€è§‚å¯Ÿé•¿ä»»åŠ¡ï¼ˆperformance ä¸­ Taskï¼‰

```js
const observer = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log(entry);
  }
});

observer.observe({ entryTypes: ["longtask"] });
```

#### 3ã€ç›‘å¬ç½‘ç»œå˜åŒ–

ç½‘ç»œå˜åŒ–æ—¶ç»™ç”¨æˆ·åé¦ˆç½‘ç»œé—®é¢˜ï¼Œæœ‰æ—¶å€™çœ‹ç›´æ’­çš„æ—¶å€™è‡ªå·±çš„ç½‘ç»œå¡é¡¿ï¼Œç›´æ’­å¹³å°ä¹Ÿä¼šæé†’ä½ æˆ–è€…è‡ªåŠ¨ç»™ä½ åˆ‡æ¢æ¸…æ™°åº¦

```js
var connection =
  navigator.connection || navigator.mozConnection || navigator.webkitConnection;
var type = connection.effectiveType;

function updateConnectionStatus() {
  console.log(
    "Connection type changed from " + type + " to " + connection.effectiveType
  );
  type = connection.effectiveType;
}

connection.addEventListener("change", updateConnectionStatus);
```

#### 4ã€è®¡ç®— DOMContentLoaded æ—¶é—´

```js
window.addEventListener("DOMContentLoaded", (event) => {
  let timing = performance.getEntriesByType("navigation")[0];
  console.log(timing.domInteractive);
  console.log(timing.fetchStart);
  let diff = timing.domInteractive - timing.fetchStart;
  console.log("TTI: " + diff);
});
```

#### 5ã€æ›´å¤šè®¡ç®—è§„åˆ™

```
DNS è§£æè€—æ—¶: domainLookupEnd - domainLookupStart
TCP è¿æ¥è€—æ—¶: connectEnd - connectStart
SSL å®‰å…¨è¿æ¥è€—æ—¶: connectEnd - secureConnectionStart
ç½‘ç»œè¯·æ±‚è€—æ—¶ (TTFB): responseStart - requestStart
æ•°æ®ä¼ è¾“è€—æ—¶: responseEnd - responseStart
DOM è§£æè€—æ—¶: domInteractive - responseEnd
èµ„æºåŠ è½½è€—æ—¶: loadEventStart - domContentLoadedEventEnd
First Byte æ—¶é—´: responseStart - domainLookupStart
ç™½å±æ—¶é—´: responseEnd - fetchStart
é¦–æ¬¡å¯äº¤äº’æ—¶é—´: domInteractive - fetchStart
DOM Ready æ—¶é—´: domContentLoadEventEnd - fetchStart
é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´: loadEventStart - fetchStart
http å¤´éƒ¨å¤§å°ï¼š transferSize - encodedBodySize
é‡å®šå‘æ¬¡æ•°ï¼šperformance.navigation.redirectCount
é‡å®šå‘è€—æ—¶: redirectEnd - redirectStart
```

### ä¸‰ã€è€ç”Ÿå¸¸è°ˆï¼Œé›…è™å†›è§„

ç£¨å¥½åˆ€äº†ï¼Œå°±è¯¥æƒ³æƒ³å¾€å“ªé‡Œæ…æ¯”è¾ƒå¥½äº†~ ğŸ—¡ğŸ—¡ğŸ—¡

å…³äºé›…è™å†›è§„ï¼Œä½ çŸ¥é“çš„æœ‰å¤šå°‘æ¡ï¼Œå¹³æ—¶å†™ç”¨åˆ°çš„åˆæœ‰å“ªäº›ï¼Ÿé’ˆå¯¹ä»¥ä¸‹è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾ˆå¤šä¼˜åŒ–å·¥ä½œ
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p12-yahoo-performance.png)

#### 1ã€å‡å°‘ cookie ä¼ è¾“

cookie ä¼ è¾“ä¼šé€ æˆå¸¦å®½æµªè´¹ï¼Œå¯ä»¥ï¼š

- å‡å°‘ cookie ä¸­å­˜å‚¨çš„ä¸œè¥¿
- é™æ€èµ„æºä¸éœ€è¦ cookieï¼Œå¯ä»¥é‡‡ç”¨å…¶ä»–çš„åŸŸåï¼Œä¸ä¼šä¸»åŠ¨å¸¦ä¸Š cookieã€‚

#### 2ã€é¿å…è¿‡å¤šçš„å›æµä¸é‡ç»˜

è¿ç»­è§¦å‘é¡µé¢å›æµæ“ä½œ

```js
let cards = document.getElementsByClassName("MuiPaper-rounded");
const update = (timestamp) => {
  for (let i = 0; i < cards.length; i++) {
    let top = cards[i].offsetTop;
    cards[i].style.width =
      Math.sin(cards[i].offsetTop + timestamp / 100 + 1) * 500 + "px";
  }
  window.requestAnimationFrame(update);
};
update(1000);
```

çœ‹ä¸‹æ•ˆæœï¼Œå¾ˆæ˜æ˜¾çš„å¡é¡¿
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p13-reflow1.gif)

performance åˆ†æç»“æœï¼Œload äº‹ä»¶ä¹‹åå­˜åœ¨å¤§é‡çš„å›æµï¼Œå¹¶ä¸” chrome éƒ½ç»™æ ‡è®°äº†çº¢è‰²
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p14-reflow2.png)

ä½¿ç”¨ fastDom è¿›è¡Œä¼˜åŒ–ï¼Œå°†å¯¹ dom çš„è¯»å’Œå†™åˆ†ç¦»ï¼Œåˆå¹¶

```js
let cards = document.getElementsByClassName("MuiPaper-rounded");
const update = (timestamp) => {
  for (let i = 0; i < cards.length; i++) {
    fastdom.measure(() => {
      let top = cards[i].offsetTop;
      fastdom.mutate(() => {
        cards[i].style.width = Math.sin(top + timestamp / 100 + 1) * 500 + "px";
      });
    });
  }
  window.requestAnimationFrame(update);
};
update(1000);
```

å†çœ‹ä¸‹æ•ˆæœï¼Œå¾ˆæµç•…~
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p15-reflow3.gif)
performance åˆ†æç»“æœï¼Œload äº‹ä»¶ä¹‹åä¹Ÿæ²¡æœ‰äº†é‚£ä¹ˆå¤šçš„çº¢è‰²æ ‡è®°
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p16-reflow4.png)
æ„Ÿå…´è¶£çš„å¯ä»¥å»äº†è§£ä¸€ä¸‹ fastDomï¼š[github fastdom](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fwilsonpage%2Ffastdom) åœ¨çº¿é¢„è§ˆï¼š[fastdom demo](https://link.juejin.cn/?target=http%3A%2F%2Fwilsonpage.github.io%2Ffastdom%2Fexamples%2Fanimation.html)

å…³äºä»»åŠ¡æ‹†åˆ†ä¸ç»„åˆçš„æ€æƒ³ï¼Œreact fiber æ¶æ„åšçš„å¾ˆç‰›é€¼ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»äº†è§£ä¸€ä¸‹è°ƒåº¦ç®—æ³•åœ¨ fiber ä¸­çš„å®è·µ

### å››ã€å‹ç¼©

å—¯å“¼å“¼ã€ç¡®å®šä¸€ä¸‹æ²¡æœ‰èµ°é”™åœºå­ï¼Œç»§ç»­ç»§ç»­ï¼

#### 1ã€Gzip

å¼€å¯æ–¹å¼å¯å‚è€ƒï¼š[nginx å¼€å¯ gzip](https://juejin.cn/post/6844903605187641357)
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/p17-gzip.png)
è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼šæ‰“åŒ…çš„æ—¶å€™ç”Ÿæˆ gz æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ï¼Œè¿™æ ·å°±ä¸éœ€è¦ nginx æ¥å‹ç¼©äº†ï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨å‹åŠ›ã€‚ å¯å‚è€ƒï¼š[gzip å‹ç¼©æ–‡ä»¶&webPack é…ç½® Compression-webpack-plugin](https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000020976930)

#### 2ã€æœåŠ¡ç«¯å‹ç¼©

`server.js`

```js
const express = require("express");
const app = express();
const fs = require("fs");
const compression = require("compression");
const path = require("path");

app.use(compression());
app.use(express.static("build"));

app.get("*", (req, res) => {
  res.sendFile(path.join(__dirname + "/build/index.html"));
});

const listener = app.listen(process.env.PORT || 3000, function() {
  console.log(`Listening on port ${listener.address().port}`);
});
```

`package.json`

```
"start": "npm run build && node server.js",
```

#### 3ã€JavaScriptã€Cssã€Html å‹ç¼©

å·¥ç¨‹åŒ–é¡¹ç›®ä¸­ç›´æ¥ä½¿ç”¨å¯¹åº”çš„æ’ä»¶å³å¯ï¼Œwebpack çš„ä¸»è¦æœ‰ä¸‹é¢ä¸‰ä¸ªï¼š

- UglifyJS
- webpack-parallel-uglify-plugin
- terser-webpack-plugin

å…·ä½“ä¼˜ç¼ºç‚¹å¯å‚è€ƒï¼š[webpack å¸¸ç”¨çš„ä¸‰ç§ JS å‹ç¼©æ’ä»¶](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fqq_24147051%2Farticle%2Fdetails%2F103557728)ã€‚å‹ç¼©åŸç†ç®€å•çš„è®²å°±æ˜¯å»é™¤ä¸€äº›ç©ºæ ¼ã€æ¢è¡Œã€æ³¨é‡Šï¼Œå€ŸåŠ© es6 æ¨¡å—åŒ–çš„åŠŸèƒ½ï¼Œåšäº†ä¸€äº› tree-shaking çš„ä¼˜åŒ–ã€‚åŒæ—¶åšäº†ä¸€äº›ä»£ç æ··æ·†ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†æ›´å°çš„ä½“ç§¯ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ä¸ºäº†æºç çš„å®‰å…¨æ€§ã€‚

css å‹ç¼©ä¸»è¦æ˜¯ mini-css-extract-pluginï¼Œå½“ç„¶å‰é¢çš„ js å‹ç¼©æ’ä»¶ä¹Ÿä¼šç»™ä½ åšå¥½ css å‹ç¼©ã€‚ä½¿ç”¨å§¿åŠ¿ï¼š

```
npm install --save-dev mini-css-extract-plugin
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
plugins:[
  new MiniCssExtractPlugin({
    filename: "[name].css",
    chunkFilename: "[id].css"
  })
]
```

html å‹ç¼©å¯ä»¥ç”¨ HtmlWebpackPluginï¼Œå•é¡µé¡¹ç›®å°±ä¸€ä¸ª index.html,æ€§èƒ½æå‡å¾®ä¹å…¶å¾®~

#### 4ã€http2 é¦–éƒ¨å‹ç¼©

http2 çš„ç‰¹ç‚¹

- äºŒè¿›åˆ¶åˆ†å¸§
- é¦–éƒ¨å‹ç¼©
- æµé‡æ§åˆ¶
- å¤šè·¯å¤ç”¨
- è¯·æ±‚ä¼˜å…ˆçº§
- æœåŠ¡å™¨æ¨é€ `http2_push: 'xxx.jpg'`
  å…·ä½“å‡çº§æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œä¿®æ”¹ä¸€ä¸‹ nginx é…ç½®ï¼Œæ–¹æ³•è¯·è‡ªè¡Œ Google

### äº”ã€webpack ä¼˜åŒ–

ä¸Šæ–‡ä¸­ä¹Ÿæåˆ°äº†éƒ¨åˆ† webpack æ’ä»¶ï¼Œä¸‹é¢æˆ‘å†æ¥çœ‹çœ‹è¿˜æœ‰å“ªäº›~

#### 1ã€DllPlugin æå‡æ„å»ºé€Ÿåº¦

é€šè¿‡ DllPlugin æ’ä»¶ï¼Œå°†ä¸€äº›æ¯”è¾ƒå¤§çš„ï¼ŒåŸºæœ¬å¾ˆå°‘å‡çº§çš„åŒ…æ‹†åˆ†å‡ºæ¥ï¼Œç”Ÿæˆ xx.dll.js æ–‡ä»¶,é€šè¿‡ manifest.json å¼•ç”¨

`webpack.dll.config.js`

```js
const path = require("path");
const webpack = require("webpack");
module.exports = {
  mode: "production",
  entry: {
    react: ["react", "react-dom"],
  },
  output: {
    filename: "[name].dll.js",
    path: path.resolve(**dirname, "dll"),
    library: "[name]"
  },
  plugins: [
    new webpack.DllPlugin({
    name: "[name]",
    path: path.resolve(**dirname, "dll/[name].manifest.json")
  })
  ]
};
```

`package.json`

```
"scripts": {
  "dll-build": "NODE_ENV=production webpack --config webpack.dll.config.js",
},
```

#### 2ã€splitChunks æ‹†åŒ…

```
optimization: {
  splitChunks: {
    cacheGroups: {
      vendor: {
          name: 'vendor',
          test: /[\\/]node_modules[\\/]/,
          minSize: 0,
          minChunks: 1,
          priority: 10,
          chunks: 'initial'
      },
      common: {
        name: 'common',
        test: /[\\/]src[\\/]/,
        chunks: 'all',
        minSize: 0,
        minChunks: 2
      }
    }
  }
},
```

## å…­ã€éª¨æ¶å±

ç”¨ css æå‰å å¥½ä½ç½®ï¼Œå½“èµ„æºåŠ è½½å®Œæˆå³å¯å¡«å……ï¼Œå‡å°‘é¡µé¢çš„å›æµä¸é‡ç»˜ï¼ŒåŒæ—¶è¿˜èƒ½ç»™ç”¨æˆ·æœ€ç›´æ¥çš„åé¦ˆã€‚ å›¾ä¸­ä½¿ç”¨æ’ä»¶ï¼š[react-placeholder](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fbuildo%2Freact-placeholder)
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/skeleton.gif)

å…³äºå®ç°éª¨æ¶å±è¿˜æœ‰å¾ˆå¤šç§æ–¹æ¡ˆï¼Œç”¨ Puppeteer æœåŠ¡ç«¯æ¸²æŸ“çš„æŒºå¤šçš„

ä½¿ç”¨ css ä¼ªç±»ï¼š[åªè¦ css å°±èƒ½å®ç°çš„éª¨æ¶å±æ–¹æ¡ˆ](https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000020437426)

ç­‰ç­‰

## ä¸ƒã€çª—å£åŒ–

åŸç†ï¼šåªåŠ è½½å½“å‰çª—å£èƒ½æ˜¾ç¤ºçš„ DOM å…ƒç´ ï¼Œå½“è§†å›¾å˜åŒ–æ—¶ï¼Œåˆ é™¤éšè—çš„ï¼Œæ·»åŠ è¦æ˜¾ç¤ºçš„ DOM å°±å¯ä»¥ä¿è¯é¡µé¢ä¸Šå­˜åœ¨çš„ dom å…ƒç´ æ•°é‡æ°¸è¿œä¸å¤šï¼Œé¡µé¢å°±ä¸ä¼šå¡é¡¿

å›¾ä¸­ä½¿ç”¨çš„æ’ä»¶ï¼š[react-window](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fbvaughn%2Freact-window)
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/react-window.gif)
å®‰è£…ï¼š`npm i react-window`

å¼•å…¥ï¼š`import { FixedSizeList as List } from 'react-window';`

ä½¿ç”¨ï¼š

```js
const Row = ({ index, style }) => <div style={style}>Row {index}</div>;

const Example = () => (
  <List height={150} itemCount={1000} itemSize={35} width={300}>
    {Row}
  </List>
);
```

## å…«ã€ç¼“å­˜

### 1ã€http ç¼“å­˜

#### keep-alive

åˆ¤æ–­æ˜¯å¦å¼€å¯ï¼šçœ‹ response headers ä¸­æœ‰æ²¡æœ‰ Connection: keep-alive ã€‚å¼€å¯ä»¥åï¼Œçœ‹ network çš„ç€‘å¸ƒæµä¸­å°±æ²¡æœ‰ Initial connection è€—æ—¶äº†

nginx è®¾ç½® keep-aliveï¼ˆé»˜è®¤å¼€å¯ï¼‰

```
# 0 ä¸ºå…³é—­

#keepalive_timeout 0;

# 65s æ— è¿æ¥ å…³é—­

keepalive_timeout 65;

# è¿æ¥æ•°ï¼Œè¾¾åˆ° 100 æ–­å¼€

keepalive_requests 100;
```

#### Cache-Control / Expires / Max-Age

è®¾ç½®èµ„æºæ˜¯å¦ç¼“å­˜ï¼Œä»¥åŠç¼“å­˜æ—¶é—´

#### Etag / If-None-Match

èµ„æºå”¯ä¸€æ ‡è¯†ä½œå¯¹æ¯”ï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œä»æœåŠ¡å™¨æ‹‰å–èµ„æºã€‚å¦‚æœæ²¡å˜åŒ–åˆ™å–ç¼“å­˜èµ„æºï¼ŒçŠ¶æ€ç  304ï¼Œä¹Ÿå°±æ˜¯åå•†ç¼“å­˜

#### Last-Modified / If-Modified-Since

é€šè¿‡å¯¹æ¯”æ—¶é—´çš„å·®å¼‚æ¥è§‰å¾—è¦ä¸è¦ä»æœåŠ¡å™¨è·å–èµ„æº

æ›´å¤š HTTP ç¼“å­˜å‚æ•°å¯å‚è€ƒï¼š[ä½¿ç”¨ HTTP ç¼“å­˜ï¼šEtag, Last-Modified ä¸ Cache-Control](https://link.juejin.cn/?target=https%3A%2F%2Fharttle.land%2F2017%2F04%2F04%2Fusing-http-cache.html)

### 2ã€Service Worker

å€ŸåŠ© webpack æ’ä»¶ WorkboxWebpackPlugin å’Œ ManifestPlugin,åŠ è½½ serviceWorker.js,é€šè¿‡ serviceWorker.register()æ³¨å†Œ

```
new WorkboxWebpackPlugin.GenerateSW({
    clientsClaim: true,
    exclude: [/\.map$/, /asset-manifest\.json$/],
    importWorkboxFrom: 'cdn',
    navigateFallback: paths.publicUrlOrPath + 'index.html',
    navigateFallbackBlacklist: [
      new RegExp('^/\_'),
      new RegExp('/[^/?]+\\.[^/]+\$'),
    ],
}),

new ManifestPlugin({
  fileName: 'asset-manifest.json',
  publicPath: paths.publicUrlOrPath,
  generate: (seed, files, entrypoints) => {
    const manifestFiles = files.reduce((manifest, file) => {
      manifest[file.name] = file.path;
      return manifest;
    }, seed);
    const entrypointFiles = entrypoints.app.filter(
      fileName => !fileName.endsWith('.map'));
    return {
            files: manifestFiles,
            entrypoints: entrypointFiles,
        };
  },

}),
```

![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/service-worker.png)

## ä¹ã€é¢„åŠ è½½ && æ‡’åŠ è½½

### 1ã€preload

å°±æ‹¿ demo ä¸­çš„å­—ä½“ä¸¾ä¾‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹çš„åŠ è½½é¡ºåºæ˜¯è¿™æ ·çš„ï¼š
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/no-preload.png)
åŠ å…¥ preloadï¼š

```
<link rel="preload" href="https://fonts.gstatic.com/s/longcang/v5/LYjAdGP8kkgoTec8zkRgqHAtXN-dRp6ohF_hzzTtOcBgYoCKmPpHHEBiM6LIGv3EnKLjtw.119.woff2" as="font" crossorigin="anonymous"/>
<link rel="preload" href="https://fonts.gstatic.com/s/longcang/v5/LYjAdGP8kkgoTec8zkRgqHAtXN-dRp6ohF_hzzTtOcBgYoCKmPpHHEBiM6LIGv3EnKLjtw.118.woff2" as="font" crossorigin="anonymous"/>
<link rel="preload" href="https://fonts.gstatic.com/s/longcang/v5/LYjAdGP8kkgoTec8zkRgqHAtXN-dRp6ohF_hzzTtOcBgYoCKmPpHHEBiM6LIGv3EnKLjtw.116.woff2" as="font" crossorigin="anonymous"/>
```

![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/proload.png)

### 2ã€prefetch

åœºæ™¯ï¼šé¦–é¡µä¸éœ€è¦è¿™æ ·çš„å­—ä½“æ–‡ä»¶ï¼Œä¸‹ä¸ªé¡µé¢éœ€è¦ï¼šé¦–é¡µä¼šä»¥æœ€ä½ä¼˜å…ˆçº§ Lowest æ¥æå‰åŠ è½½

åŠ å…¥ prefetchï¼š

```
<link rel="prefetch" href="https://fonts.gstatic.com/s/longcang/v5/LYjAdGP8kkgoTec8zkRgqHAtXN-dRp6ohF_hzzTtOcBgYoCKmPpHHEBiM6LIGv3EnKLjtw.113.woff2" as="font"/>
<link rel="prefetch" href="https://fonts.gstatic.com/s/longcang/v5/LYjAdGP8kkgoTec8zkRgqHAtXN-dRp6ohF_hzzTtOcBgYoCKmPpHHEBiM6LIGv3EnKLjtw.118.woff2" as="font"/>
<link rel="prefetch" href="https://fonts.gstatic.com/s/longcang/v5/LYjAdGP8kkgoTec8zkRgqHAtXN-dRp6ohF_hzzTtOcBgYoCKmPpHHEBiM6LIGv3EnKLjtw.117.woff2" as="font"/>
```

éœ€è¦çš„é¡µé¢ï¼Œä» prefetch cache ä¸­å–
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/prefetch.png)
webpack ä¹Ÿæ˜¯æ”¯æŒè¿™ä¸¤ä¸ªå±æ€§çš„:[webpackPrefetch å’Œ webpackPreload](https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fskychx%2Fp%2Fwebpack-webpackChunkName-webpackPreload-webpackPreload.html)

### 3ã€æ‡’åŠ è½½

å›¾ç‰‡
æœºæ¢°å›¾ç‰‡
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/mechanical.png)
æ¸è¿›å¼å›¾ç‰‡ï¼ˆç±»ä¼¼é«˜æ–¯æ¨¡ç³Šï¼‰ éœ€è¦ UI å°å§å§å‡ºç¨¿çš„æ—¶å€™æŒ‡å®šè¿™ç§æ ¼å¼
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/gradual.png)
å“åº”å¼å›¾ç‰‡

åŸç”Ÿæ¨¡å¼ï¼š`<img src="./img/index.jpg" sizes="100vw" srcset="./img/dog.jpg 800w, ./img/index.jpg 1200w"/>`
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/responsive.gif)
è·¯ç”±æ‡’åŠ è½½
é€šè¿‡å‡½æ•° + import å®ç°

`const Page404 = () => import(/_ webpackChunkName: "error" _/'@views/errorPage/404');`

## åã€ssr && react-snap

- æœåŠ¡ç«¯æ¸²æŸ“ SSRï¼Œvue ä½¿ç”¨ nuxt.jsï¼Œreact ä½¿ç”¨ next.js
- react-snap å¯ä»¥å€ŸåŠ© Puppeteer å®ç°å…ˆæ¸²æŸ“å•é¡µï¼Œç„¶åä¿ç•™ DOMï¼Œå‘é€åˆ°å®¢æˆ·ç«¯

## åä¸€ã€ä½“éªŒä¼˜åŒ–

ç™½å± loading
![](http://blog-bed.oss-cn-beijing.aliyuncs.com/49.%E8%81%8A%E4%B8%80%E8%81%8A%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/loading.gif)
loading.html éœ€è¦è‡ªå–å“¦ï¼Œè¿˜æœ‰ç§æ–¹å¼ï¼Œä½¿ç”¨ webpack æ’ä»¶ HtmlWebpackPlugin å°† loading èµ„æºæ’å…¥åˆ°é¡µé¢ä¸­

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loading</title>
    <style>
      body {
        margin: 0;
      }
      #loadding {
        position: fixed;
        top: 0;
        bottom: 0;
        display: flex;
        width: 100%;
        align-items: center;
        justify-content: center;
      }
      #loadding > span {
        display: inline-block;
        width: 8px;
        height: 100%;
        margin-right: 5px;
        border-radius: 4px;
        -webkit-animation: load 1.04s ease infinite;
        animation: load 1.04s ease infinite;
      }
      @keyframes load {
        0%,
        100% {
          height: 40px;
          background: #98beff;
        }
        50% {
          height: 60px;
          margin-top: -20px;
          background: #3e7fee;
        }
      }
    </style>
  </head>

  <body>
    <div id="loadding">
      <span></span>
      <span style="animation-delay: 0.13s"></span>
      <span style="animation-delay: 0.26s"></span>
      <span style="animation-delay: 0.39s"></span>
      <span style="animation-delay: 0.52s"></span>
    </div>
  </body>
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const $loadding = document.getElementById("loadding");
      if (!$loadding) {
        return;
      }
      $loadding.style.display = "none";
      $loadding.parentNode.removeChild($loadding);
    });
  </script>
</html>
```

æ›´å¤šæ€§èƒ½ä¼˜åŒ–ï¼Œæ•¬è¯·æœŸå¾…~
å­¦ä¹  + æ•´ç†è¿™äº›èŠ±äº†å¾ˆé•¿æ—¶é—´ï¼Œè·¯è¿‡çš„å¤§å“¥ä»¬ã€å°å§å§ä»¬è¿˜è¯·ç»™ä¸ªèµ ğŸ‘ï¼Œæœ‰é—®é¢˜çš„ä¹Ÿå¯ç•™è¨€äº¤æµå“ˆ ğŸ˜

## å‚è€ƒæ–‡ç« ï¼š

- Mr.Max æŸè¯¾ç½‘è§†é¢‘ã€é“¾æ¥ä¼šè¿è§„ï¼Œè¯·è‡ªè¡Œæœç´¢ã€‘
- [å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹é›…è™ 35 æ¡å†›è§„](https://juejin.cn/post/6844903657318645767#heading-1)
- [webpack å®è·µâ€”â€”webpack-bundle-analyzer çš„ä½¿ç”¨](https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000012220132)
- [nginx å¼€å¯ gzip](https://juejin.cn/post/6844903605187641357)
- [gzip å‹ç¼©æ–‡ä»¶&webPack é…ç½® Compression-webpack-plugin](https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000020976930)
- [webpack å¸¸ç”¨çš„ä¸‰ç§ JS å‹ç¼©æ’ä»¶](https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fqq_24147051%2Farticle%2Fdetails%2F103557728)
- [åªè¦ css å°±èƒ½å®ç°çš„éª¨æ¶å±æ–¹æ¡ˆ](https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000020437426)
- [ä½¿ç”¨ HTTP ç¼“å­˜ï¼šEtag, Last-Modified ä¸ Cache-Control](https://link.juejin.cn/?target=https%3A%2F%2Fharttle.land%2F2017%2F04%2F04%2Fusing-http-cache.html)
- [webpackPrefetch å’Œ webpackPreload](https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fskychx%2Fp%2Fwebpack-webpackChunkName-webpackPreload-webpackPreload.html)
